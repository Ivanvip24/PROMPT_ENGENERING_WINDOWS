<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design Prompt Generator - AXKAN</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --axkan-pink: #E91E63;
            --axkan-green: #7CB342;
            --axkan-orange: #FF9800;
            --axkan-turquoise: #00BCD4;
            --axkan-red: #F44336;

            --bg-primary: #F8F9FC;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #F1F3F9;

            --text-primary: #1A202C;
            --text-secondary: #4A5568;
            --text-tertiary: #718096;

            --border-light: #E2E8F0;
            --border-medium: #CBD5E0;

            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light);
            padding: 20px 40px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .header-container {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .axkan-logo {
            height: 48px;
            display: block;
        }

        .brand-section {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .brand-name {
            font-size: 24px;
            font-weight: 800;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--axkan-pink), var(--axkan-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .brand-tagline {
            font-size: 13px;
            color: var(--text-tertiary);
            font-weight: 500;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .current-project-badge {
            background: var(--bg-tertiary);
            padding: 10px 20px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid var(--border-light);
        }

        .project-icon {
            font-size: 20px;
        }

        .project-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .language-switcher {
            display: flex;
            gap: 4px;
            background: var(--bg-tertiary);
            padding: 4px;
            border-radius: var(--radius-md);
        }

        .lang-btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--radius-sm);
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .lang-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .lang-btn.active {
            background: linear-gradient(135deg, var(--axkan-pink), var(--axkan-orange));
            color: white;
            box-shadow: var(--shadow-sm);
        }

        /* Main Container */
        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px;
        }

        /* Card */
        .card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 32px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            margin-bottom: 24px;
        }

        .card-header {
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Project Selector */
        .project-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .project-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 28px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 16px;
            position: relative;
            overflow: hidden;
        }

        .project-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--axkan-pink), var(--axkan-green), var(--axkan-orange), var(--axkan-turquoise));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .project-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--axkan-pink);
        }

        .project-card:hover::before {
            opacity: 1;
        }

        .project-card.active {
            border-color: var(--axkan-pink);
            border-width: 3px;
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.05), rgba(255, 152, 0, 0.05));
            box-shadow: var(--shadow-lg);
        }

        .project-card.active::before {
            opacity: 1;
        }

        .project-card-icon {
            font-size: 40px;
            line-height: 1;
        }

        .project-card-content {
            flex: 1;
        }

        .project-card-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-md);
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s ease;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--axkan-pink);
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.1);
        }

        .form-textarea {
            min-height: 140px;
            resize: vertical;
            line-height: 1.6;
        }

        .form-help {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Buttons */
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-family: 'Inter', sans-serif;
            letter-spacing: -0.2px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--axkan-pink) 0%, var(--axkan-orange) 100%);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            background: var(--border-medium);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 2px solid var(--border-light);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--border-medium);
        }

        .btn-icon {
            padding: 10px 18px;
            border-radius: var(--radius-md);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 2px solid var(--border-light);
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
        }

        .btn-icon:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--axkan-pink);
        }

        /* Number Input */
        .number-input-container {
            display: flex;
            justify-content: center;
            margin: 24px 0;
        }

        .number-input {
            width: 160px;
            padding: 24px 32px;
            border: 3px solid var(--border-light);
            border-radius: var(--radius-xl);
            font-size: 72px;
            font-weight: 900;
            text-align: center;
            background: linear-gradient(135deg, var(--axkan-pink) 0%, var(--axkan-orange) 100%);
            color: white;
            box-shadow: var(--shadow-xl);
            line-height: 1;
            transition: all 0.3s ease;
        }

        .number-input:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(233, 30, 99, 0.2), var(--shadow-xl);
        }

        .number-input:hover {
            transform: scale(1.05);
        }

        /* Product Selector */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .product-btn {
            padding: 24px 20px;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            background: var(--bg-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .product-btn:hover:not(.disabled) {
            border-color: var(--axkan-green);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .product-btn.active {
            border-color: var(--axkan-green);
            border-width: 3px;
            background: linear-gradient(135deg, rgba(124, 179, 66, 0.1), rgba(0, 188, 212, 0.1));
            box-shadow: var(--shadow-md);
        }

        .product-btn.disabled {
            background: var(--bg-tertiary);
            color: var(--text-tertiary);
            border-color: var(--border-light);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .product-icon {
            font-size: 36px;
        }

        .product-label {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            text-align: center;
        }

        /* Style Preset Pills */
        .style-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .style-pill {
            padding: 12px 24px;
            border: 2px solid var(--border-light);
            border-radius: 999px;
            background: var(--bg-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .style-pill:hover {
            border-color: var(--axkan-turquoise);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .style-pill.active {
            border-color: var(--axkan-turquoise);
            background: linear-gradient(135deg, var(--axkan-turquoise), var(--axkan-green));
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .style-pill.no-style {
            border-style: dashed;
        }

        .style-pill.no-style.active {
            background: var(--text-secondary);
        }

        /* Ratio Buttons */
        .ratio-group {
            display: flex;
            gap: 12px;
        }

        .ratio-btn {
            flex: 1;
            padding: 16px 24px;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .ratio-btn:hover {
            border-color: var(--axkan-orange);
            color: var(--text-primary);
        }

        .ratio-btn.active {
            border-color: var(--axkan-orange);
            border-width: 3px;
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(244, 67, 54, 0.1));
            color: var(--text-primary);
        }

        .ratio-icon {
            font-size: 24px;
        }

        /* Shape Gallery */
        .shape-gallery {
            background: var(--bg-tertiary);
            padding: 24px;
            border-radius: var(--radius-lg);
            margin-top: 20px;
            border: 2px solid var(--border-light);
            display: none;
        }

        .shape-gallery.visible {
            display: block;
        }

        .shape-gallery-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .shape-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
        }

        .shape-option {
            position: relative;
            cursor: pointer;
            border: 3px solid var(--border-light);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
        }

        .shape-option:hover {
            border-color: var(--axkan-turquoise);
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .shape-option.selected {
            border-color: var(--axkan-green);
            border-width: 4px;
            box-shadow: 0 0 0 4px rgba(124, 179, 66, 0.2);
        }

        .shape-option img {
            width: 100%;
            height: 180px;
            object-fit: contain;
            padding: 16px;
            background: var(--bg-secondary);
        }

        .shape-label {
            padding: 12px;
            background: var(--bg-tertiary);
            text-align: center;
            font-weight: 600;
            font-size: 13px;
            color: var(--text-primary);
        }

        .shape-option.selected .shape-label {
            background: var(--axkan-green);
            color: white;
        }

        .shape-checkmark {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 32px;
            height: 32px;
            background: var(--axkan-green);
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            box-shadow: var(--shadow-md);
        }

        .shape-option.selected .shape-checkmark {
            display: flex;
        }

        /* Photo Style Selector */
        .photo-style-selector {
            background: linear-gradient(135deg, #FFF3E0, #FFE0B2);
            padding: 24px;
            border-radius: var(--radius-lg);
            margin-top: 20px;
            border: 2px solid var(--axkan-orange);
            display: none;
        }

        .photo-style-selector.visible {
            display: block;
        }

        .photo-style-title {
            font-size: 16px;
            font-weight: 600;
            color: #E65100;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .style-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .style-option {
            position: relative;
            cursor: pointer;
            border: 3px solid #FFE0B2;
            border-radius: var(--radius-lg);
            padding: 24px;
            transition: all 0.3s ease;
            background: white;
        }

        .style-option:hover {
            border-color: var(--axkan-orange);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .style-option.selected {
            border-color: #FF6F00;
            border-width: 4px;
            box-shadow: 0 0 0 4px rgba(255, 152, 0, 0.2);
            background: #FFF3E0;
        }

        .style-option-icon {
            font-size: 36px;
            margin-bottom: 12px;
        }

        .style-option-label {
            font-weight: 600;
            font-size: 15px;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .style-option-description {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .style-radio {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 24px;
            height: 24px;
            border: 3px solid var(--border-medium);
            border-radius: 50%;
            background: white;
            transition: all 0.3s ease;
        }

        .style-option.selected .style-radio {
            background: #FF6F00;
            border-color: #FF6F00;
        }

        .style-option.selected .style-radio::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        /* Image Upload */
        .image-upload-zone {
            border: 3px dashed var(--border-medium);
            border-radius: var(--radius-lg);
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-tertiary);
        }

        .image-upload-zone:hover {
            border-color: var(--axkan-turquoise);
            background: var(--bg-secondary);
        }

        .image-upload-zone input {
            display: none;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .upload-text {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .preview-img-container {
            position: relative;
            border-radius: var(--radius-md);
            overflow: hidden;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-light);
        }

        .preview-img {
            width: 100%;
            height: 140px;
            object-fit: cover;
            display: block;
        }

        .remove-img-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            background: var(--axkan-red);
            color: white;
            border: 2px solid white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-md);
        }

        .remove-img-btn:hover {
            background: #C62828;
            transform: scale(1.1);
        }

        .image-count-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, var(--axkan-turquoise), var(--axkan-green));
            color: white;
            padding: 10px 20px;
            border-radius: 999px;
            font-weight: 600;
            font-size: 14px;
            margin-top: 16px;
            box-shadow: var(--shadow-sm);
        }

        .paste-hint {
            background: var(--bg-tertiary);
            padding: 12px 16px;
            border-radius: var(--radius-md);
            margin-top: 16px;
            font-size: 13px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid var(--border-light);
        }

        kbd {
            background: var(--text-primary);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-family: 'SF Mono', Monaco, 'Courier New', monospace;
            border: 1px solid var(--text-secondary);
            box-shadow: var(--shadow-sm);
        }

        /* Template Window */
        .instructions-layout {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 24px;
            align-items: start;
        }

        .template-window {
            background: var(--bg-tertiary);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 20px;
            position: sticky;
            top: 100px;
        }

        .template-window.hidden {
            display: none;
        }

        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .template-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .template-copy-btn {
            padding: 8px 16px;
            background: var(--axkan-green);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .template-copy-btn:hover {
            background: #689F38;
            transform: translateY(-1px);
        }

        .template-copy-btn.copied {
            background: var(--axkan-turquoise);
        }

        .template-text {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: var(--radius-sm);
            font-family: 'SF Mono', Monaco, 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
            white-space: pre-wrap;
            color: var(--text-secondary);
            border: 1px solid var(--border-light);
        }

        /* Output Section */
        .output-section {
            margin-top: 32px;
            display: none;
        }

        .output-section.visible {
            display: block;
        }

        .variations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .variation-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 2px solid var(--border-light);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 420px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }

        .variation-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .variation-header {
            padding: 16px 20px;
            background: var(--bg-tertiary);
            border-bottom: 2px solid var(--border-light);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .variation-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            text-align: center;
        }

        .copy-btn {
            padding: 8px 16px;
            background: var(--axkan-turquoise);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .copy-btn:hover {
            background: #00ACC1;
            transform: translateY(-1px);
        }

        .copy-btn.copied {
            background: var(--axkan-green);
        }

        .prompt-output {
            background: var(--bg-secondary);
            padding: 20px;
            font-family: 'SF Mono', Monaco, 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-y: auto;
            flex: 1;
            color: var(--text-secondary);
        }

        .prompt-output::-webkit-scrollbar {
            width: 8px;
        }

        .prompt-output::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        .prompt-output::-webkit-scrollbar-thumb {
            background: var(--border-medium);
            border-radius: 4px;
        }

        .prompt-output::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px;
            grid-column: 1 / -1;
        }

        .spinner {
            border: 4px solid var(--border-light);
            border-top: 4px solid var(--axkan-pink);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        .loading-text {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Settings Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.visible {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            padding: 40px;
            border-radius: var(--radius-xl);
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-xl);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-close {
            font-size: 28px;
            cursor: pointer;
            color: var(--text-tertiary);
            transition: color 0.2s ease;
        }

        .modal-close:hover {
            color: var(--axkan-red);
        }

        /* Settings Floating Button */
        .settings-fab {
            position: fixed;
            bottom: 32px;
            right: 32px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--axkan-pink), var(--axkan-orange));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            cursor: pointer;
            box-shadow: var(--shadow-xl);
            transition: all 0.3s ease;
            z-index: 99;
        }

        .settings-fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 20px 40px rgba(233, 30, 99, 0.4);
        }

        /* History Floating Button */
        .history-fab {
            position: fixed;
            bottom: 32px;
            right: 108px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--axkan-turquoise), var(--axkan-green));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            cursor: pointer;
            box-shadow: var(--shadow-xl);
            transition: all 0.3s ease;
            z-index: 999;
        }

        .history-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 20px 40px rgba(0, 188, 212, 0.4);
        }

        .history-fab .badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--axkan-red);
            color: white;
            font-size: 12px;
            font-weight: 700;
            min-width: 22px;
            height: 22px;
            border-radius: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 6px;
        }

        /* History Sidebar */
        .history-sidebar {
            position: fixed;
            top: 0;
            right: -450px;
            width: 450px;
            height: 100vh;
            background: var(--bg-secondary);
            box-shadow: -10px 0 40px rgba(0, 0, 0, 0.15);
            z-index: 1001;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .history-sidebar.visible {
            right: 0;
        }

        .history-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(2px);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .history-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .history-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #E0F7FA, #F1F8E9);
        }

        .history-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .history-close {
            font-size: 28px;
            cursor: pointer;
            color: var(--text-tertiary);
            transition: color 0.2s ease;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .history-close:hover {
            color: var(--axkan-red);
            background: rgba(244, 67, 54, 0.1);
        }

        .history-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .history-empty {
            text-align: center;
            padding: 60px 24px;
            color: var(--text-tertiary);
        }

        .history-empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .history-empty-text {
            font-size: 16px;
            font-weight: 500;
        }

        .history-item {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border-light);
            transition: all 0.2s ease;
        }

        .history-item:hover {
            border-color: var(--axkan-turquoise);
            box-shadow: var(--shadow-md);
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .history-item-project {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            padding: 4px 10px;
            border-radius: var(--radius-sm);
        }

        .history-item-date {
            font-size: 11px;
            color: var(--text-tertiary);
        }

        .history-item-preview {
            font-size: 13px;
            color: var(--text-primary);
            line-height: 1.5;
            margin-bottom: 12px;
            max-height: 80px;
            overflow: hidden;
            position: relative;
        }

        .history-item-preview::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: linear-gradient(transparent, var(--bg-tertiary));
        }

        .history-item-meta {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .history-meta-tag {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 4px;
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }

        .history-item-actions {
            display: flex;
            gap: 8px;
        }

        .history-action-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .history-action-btn.copy {
            background: var(--axkan-turquoise);
            color: white;
        }

        .history-action-btn.copy:hover {
            background: #00ACC1;
        }

        .history-action-btn.reuse {
            background: var(--axkan-green);
            color: white;
        }

        .history-action-btn.reuse:hover {
            background: #689F38;
        }

        .history-action-btn.delete {
            background: transparent;
            color: var(--text-tertiary);
            border: 1px solid var(--border-light);
            flex: 0;
            padding: 8px 10px;
        }

        .history-action-btn.delete:hover {
            background: rgba(244, 67, 54, 0.1);
            color: var(--axkan-red);
            border-color: var(--axkan-red);
        }

        .history-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border-light);
            background: var(--bg-tertiary);
        }

        .history-clear-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: var(--radius-sm);
            background: transparent;
            color: var(--axkan-red);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid var(--border-light);
        }

        .history-clear-btn:hover {
            background: rgba(244, 67, 54, 0.1);
            border-color: var(--axkan-red);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .instructions-layout {
                grid-template-columns: 1fr;
            }

            .template-window {
                position: static;
            }

            .variations-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 16px 20px;
            }

            .header-container {
                flex-direction: column;
                gap: 16px;
            }

            .main-container {
                padding: 20px;
            }

            .card {
                padding: 24px;
            }

            .project-grid {
                grid-template-columns: 1fr;
            }

            .product-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .style-options {
                grid-template-columns: 1fr;
            }

            .variations-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Optional Fields Grid */
        .optional-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
        }

        /* Slider */
        .slider-container {
            margin-top: 16px;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 999px;
            background: var(--border-light);
            outline: none;
            appearance: none;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--axkan-pink), var(--axkan-orange));
            cursor: pointer;
            box-shadow: var(--shadow-md);
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--axkan-pink), var(--axkan-orange));
            cursor: pointer;
            box-shadow: var(--shadow-md);
            border: none;
        }

        .slider-value {
            display: inline-block;
            padding: 6px 14px;
            background: linear-gradient(135deg, var(--axkan-pink), var(--axkan-orange));
            color: white;
            border-radius: 999px;
            font-weight: 700;
            font-size: 14px;
            margin-left: 12px;
            box-shadow: var(--shadow-sm);
        }

        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        /* Turbo Mode Toggle */
        .turbo-toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 32px;
            flex-shrink: 0;
        }

        .turbo-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .turbo-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 32px;
        }

        .turbo-slider:before {
            position: absolute;
            content: "";
            height: 24px;
            width: 24px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .turbo-toggle input:checked + .turbo-slider {
            background: linear-gradient(135deg, #FFC107, #FF9800);
        }

        .turbo-toggle input:checked + .turbo-slider:before {
            transform: translateX(28px);
        }

        #turboCard.turbo-active {
            border: 2px solid #FFC107;
            background: linear-gradient(135deg, #FFFDE7, #FFF8E1);
        }

        .btn-turbo {
            background: linear-gradient(135deg, #FFC107, #FF9800) !important;
            animation: turbo-pulse 1.5s ease-in-out infinite;
        }

        @keyframes turbo-pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
        }

        /* Side-by-side Layout for Instructions + AI Analyzer */
        .instructions-row {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 24px;
            margin-bottom: 24px;
        }

        @media (max-width: 1100px) {
            .instructions-row {
                grid-template-columns: 1fr;
            }
        }

        /* AI Instructions Analyzer Styles - Compact version */
        #aiAnalyzerCard {
            border: 2px dashed var(--axkan-turquoise);
            background: linear-gradient(135deg, #E3F6FC, #D4F1F9);
            margin-bottom: 0;
        }

        #aiAnalyzerCard .card-header {
            margin-bottom: 16px;
        }

        #aiAnalyzerCard .card-title {
            font-size: 22px;
            color: var(--axkan-turquoise);
            justify-content: center;
        }

        #aiAnalyzerCard .card-description {
            display: none;
        }

        .ai-analyzer-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .ai-upload-zone {
            border: 2px dashed var(--border-medium);
            border-radius: var(--radius-md);
            padding: 24px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .ai-upload-zone:hover {
            border-color: var(--axkan-pink);
            background: #FFF5F8;
            transform: translateY(-2px);
        }

        .ai-upload-zone.drag-over {
            border-color: var(--axkan-green);
            background: #F0FFF4;
        }

        .ai-upload-icon {
            font-size: 36px;
            margin-bottom: 8px;
        }

        .ai-upload-text {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .ai-upload-hint {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        /* Paste Button - Pink prominent style */
        .btn-paste-image {
            background: linear-gradient(135deg, var(--axkan-pink), #C2185B);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 999px;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }

        .btn-paste-image:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .ai-image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .ai-preview-item {
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: var(--radius-sm);
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .ai-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .ai-preview-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--axkan-red);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-analyze-section {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .btn-ai-analyze {
            background: linear-gradient(135deg, var(--axkan-turquoise), #0097A7);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: var(--radius-md);
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            flex: 1;
            justify-content: center;
        }

        .btn-ai-analyze:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-ai-analyze.analyzing {
            background: linear-gradient(135deg, #9E9E9E, #757575);
            pointer-events: none;
        }

        .ai-btn-icon {
            font-size: 24px;
        }

        .btn-clear-ai {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-medium);
            padding: 16px 24px;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
        }

        .btn-clear-ai:hover {
            background: var(--axkan-red);
            color: white;
            border-color: var(--axkan-red);
        }

        .ai-analyze-status {
            padding: 16px;
            border-radius: var(--radius-md);
            text-align: center;
            font-weight: 600;
        }

        .ai-analyze-status.loading {
            background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
            color: #1565C0;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .ai-analyze-status.success {
            background: linear-gradient(135deg, #E8F5E9, #C8E6C9);
            color: #2E7D32;
        }

        .ai-analyze-status.error {
            background: linear-gradient(135deg, #FFEBEE, #FFCDD2);
            color: #C62828;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .btn-paste-image {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn-paste-image:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, #AB47BC, #8E24AA);
        }

        .btn-paste-image span:first-child {
            font-size: 20px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="header-left">
                <img src="/axkan-logo.svg" alt="AXKAN" class="axkan-logo">
                <div class="brand-section">
                    <div class="brand-name">AXKAN</div>
                    <div class="brand-tagline" data-translate="header.tagline">Design Prompt Generator</div>
                </div>
            </div>
            <div class="header-right">
                <div class="current-project-badge">
                    <span class="project-icon" id="currentIcon">ðŸŽ¨</span>
                    <span class="project-name" id="currentProject" data-translate="header.selectProject">Select Project</span>
                </div>
                <div class="language-switcher">
                    <button class="lang-btn active" onclick="setLanguage('en')" id="lang-en">EN</button>
                    <button class="lang-btn" onclick="setLanguage('es')" id="lang-es">ES</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Project Selection Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <span>ðŸŽ¯</span>
                    <span data-translate="projectCard.title">Choose Your Project Type</span>
                </h2>
                <p class="card-description" data-translate="projectCard.description">Select the type of design project you want to work on</p>
            </div>
            <div class="project-grid" id="projectSelector">
                <!-- Projects will be loaded here dynamically -->
            </div>
        </div>

        <!-- Side-by-side: Instructions + AI Analyzer -->
        <div class="instructions-row">
            <!-- Instructions Card (LEFT) -->
            <div class="card" style="margin-bottom: 0;">
                <div class="card-header">
                    <h2 class="card-title">
                        <span>âœï¸</span>
                        <span data-translate="instructionsCard.title">What Would You Like to Create?</span>
                    </h2>
                    <p class="card-description" data-translate="instructionsCard.description">Describe your design idea in detail</p>
                </div>
                <div>
                    <textarea
                        id="instructions"
                        class="form-textarea"
                        data-translate-placeholder="instructionsCard.placeholder"
                        placeholder="Describe what you want... For example: 'Create a variation with the Ãngel swimming in water with marine decorations' or 'Change the character's clothing to traditional Mexican dress'"
                    ></textarea>
                    <div class="form-help">
                        <span>ðŸ’¡</span>
                        <span data-translate="instructionsCard.help">Be as specific as possible about what you want to change or create</span>
                    </div>
                </div>
            </div>

            <!-- AI Instructions Analyzer Card (RIGHT) -->
            <div class="card" id="aiAnalyzerCard">
                <div class="card-header">
                    <h2 class="card-title">
                        <span>ðŸ¤–</span>
                        <span data-translate="aiAnalyzer.title">AI Instructions Analyzer</span>
                    </h2>
                    <p class="card-description" data-translate="aiAnalyzer.description">Upload client screenshots or instructions - AI will fill all fields automatically</p>
                </div>
                <div class="ai-analyzer-content">
                    <div class="ai-upload-zone" id="aiUploadZone" onclick="document.getElementById('aiInstructionImages').click()">
                        <input type="file" id="aiInstructionImages" multiple accept="image/*" style="display: none;" onchange="handleAiImages(this.files)">
                        <div class="ai-upload-icon">ðŸ“¸</div>
                        <div class="ai-upload-text" data-translate="aiAnalyzer.uploadText">Drop or click to upload client instructions</div>
                        <div class="ai-upload-hint" data-translate="aiAnalyzer.uploadHint">WhatsApp screenshots, emails, handwritten notes, etc.</div>
                    </div>
                    <button class="btn btn-paste-image" onclick="pasteAiImage(event)">
                        <span>ðŸ“‹</span>
                        <span data-translate="aiAnalyzer.pasteBtn">Paste from clipboard</span>
                    </button>
                    <div id="aiImagePreview" class="ai-image-preview"></div>
                    <div id="aiAnalyzeSection" class="ai-analyze-section" style="display: none;">
                        <button class="btn btn-ai-analyze" id="aiAnalyzeBtn" onclick="analyzeInstructions()">
                            <span class="ai-btn-icon">ðŸ¤–</span>
                            <span data-translate="aiAnalyzer.analyzeBtn">Analyze & Auto-Fill All Fields</span>
                        </button>
                        <button class="btn btn-clear-ai" onclick="clearAiImages()">
                            <span data-translate="aiAnalyzer.clearBtn">Clear</span>
                        </button>
                    </div>
                    <div id="aiAnalyzeStatus" class="ai-analyze-status" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- Variation Count Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <span>ðŸ”¢</span>
                    <span data-translate="variationCard.title">Number of Variations</span>
                </h2>
                <p class="card-description" data-translate="variationCard.description">Each variation will be generated with a unique approach</p>
            </div>
            <div class="number-input-container">
                <input
                    type="number"
                    id="variationCount"
                    class="number-input"
                    value="1"
                    min="1"
                    max="10"
                    placeholder="#"
                >
            </div>
            <div class="form-help" style="text-align: center; justify-content: center;">
                <span>ðŸ“Š</span>
                <span data-translate="variationCard.help">Generate between 1 and 10 unique variations</span>
            </div>
        </div>

        <!-- Dynamic Fields Container -->
        <div id="dynamicFields">
            <!-- Fields will be inserted here based on selected project -->
        </div>

        <!-- Image Upload Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <span>ðŸ–¼ï¸</span>
                    <span data-translate="imageCard.title">Reference Images (Optional)</span>
                </h2>
                <p class="card-description" data-translate="imageCard.description">Upload images to guide the design generation</p>
            </div>
            <div class="image-upload-zone" id="imageUpload">
                <div class="upload-icon">ðŸ“·</div>
                <div class="upload-text" data-translate="imageCard.uploadText">Click to upload or paste images</div>
                <div class="upload-hint" data-translate="imageCard.uploadHint">PNG, JPG, or GIF - Add as many as you need!</div>
                <input type="file" id="imageInput" multiple accept="image/*">
            </div>
            <div class="paste-hint">
                <span>ðŸ’¡</span>
                <span data-translate="imageCard.pasteHint"><strong>Pro Tip:</strong> Copy an image and press <kbd>Cmd+V</kbd> (Mac) or <kbd>Ctrl+V</kbd> (Windows) anywhere on this page to add it!</span>
            </div>
            <div id="imageCountDisplay" class="image-count-badge" style="display: none;">
                <span>ðŸ“¸</span>
                <span id="imageCount">0</span> <span data-translate="imageCard.imagesAttached">image(s) attached</span>
                <button onclick="clearAllImages()" class="btn-icon" style="margin-left: 12px; padding: 6px 12px; background: var(--axkan-red); color: white; border: none;" data-translate="imageCard.clearAll">Clear All</button>
            </div>
            <div class="form-help" id="imagesPersistNote" style="display: none; color: var(--axkan-turquoise); font-weight: 600;">
                <span>âœ“</span>
                <span data-translate="imageCard.persistNote">Images will be used for all generations until you remove them</span>
            </div>
            <div class="image-preview-grid" id="imagePreview"></div>
        </div>

        <!-- Turbo Mode Toggle -->
        <div class="card" id="turboCard">
            <div class="card-header" style="padding-bottom: 0;">
                <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 28px;">âš¡</span>
                        <div>
                            <h3 class="card-title" style="margin: 0;" data-translate="turboCard.title">Turbo Mode</h3>
                            <p class="card-description" style="margin: 4px 0 0 0;" data-translate="turboCard.description">Generate ultra-fast short prompts (max 250 words)</p>
                        </div>
                    </div>
                    <label class="turbo-toggle">
                        <input type="checkbox" id="turboToggle" onchange="toggleTurboMode(this.checked)">
                        <span class="turbo-slider"></span>
                    </label>
                </div>
            </div>
            <div id="turboInfo" class="turbo-info" style="display: none;">
                <div style="background: linear-gradient(135deg, #FFF8E1, #FFECB3); padding: 12px 16px; border-radius: 8px; margin-top: 12px; border-left: 4px solid #FFC107;">
                    <span style="font-weight: 600; color: #F57C00;" data-translate="turboCard.activeMessage">âš¡ Turbo active: Prompts will be hyper-optimized for speed (~250 words)</span>
                </div>
            </div>
        </div>

        <!-- Generate Button -->
        <div class="card">
            <button class="btn btn-primary" id="generateBtn" style="width: 100%; padding: 20px; font-size: 17px;">
                <span style="font-size: 24px;" id="generateBtnIcon">âœ¨</span>
                <span data-translate="generateBtn.text" id="generateBtnText">Generate Design Prompts</span>
            </button>
        </div>

        <!-- Output Section -->
        <div class="output-section" id="outputSection">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <span>ðŸŽ¨</span>
                        <span data-translate="outputCard.title">Generated Prompts</span>
                    </h2>
                    <p class="card-description" data-translate="outputCard.description">Copy and use these prompts in your design tool</p>
                </div>
                <div class="variations-grid" id="variationsContainer">
                    <!-- Variation cards will be inserted here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" data-translate="settings.title">âš™ï¸ Settings</div>
                <span class="modal-close" onclick="closeSettings()">&times;</span>
            </div>
            <div class="form-group">
                <label class="form-label" for="apiKey" data-translate="settings.apiKeyLabel">Claude API Key (Optional)</label>
                <input
                    type="password"
                    id="apiKey"
                    class="form-input"
                    placeholder="sk-ant-..."
                >
                <div class="form-help">
                    <span>ðŸ”‘</span>
                    <span data-translate="settings.apiKeyHelp">Add your Anthropic API key to enable automatic prompt generation. Leave empty to use template mode.</span>
                </div>
            </div>
            <button class="btn btn-primary" style="width: 100%; margin-top: 24px;" onclick="saveSettings()" data-translate="settings.saveBtn">
                Save Settings
            </button>
        </div>
    </div>

    <!-- Settings Floating Action Button -->
    <div class="settings-fab" onclick="openSettings()">âš™ï¸</div>

    <!-- History Floating Action Button -->
    <div class="history-fab" onclick="toggleHistory()">
        ðŸ“œ
        <span class="badge" id="historyBadge" style="display: none;">0</span>
    </div>

    <!-- History Overlay -->
    <div class="history-overlay" id="historyOverlay" onclick="toggleHistory()"></div>

    <!-- History Sidebar -->
    <div class="history-sidebar" id="historySidebar">
        <div class="history-header">
            <div class="history-title">
                <span>ðŸ“œ</span>
                <span data-translate="history.title">Generation History</span>
            </div>
            <span class="history-close" onclick="toggleHistory()">&times;</span>
        </div>
        <div class="history-content" id="historyContent">
            <div class="history-empty" id="historyEmpty">
                <div class="history-empty-icon">ðŸ“­</div>
                <div class="history-empty-text" data-translate="history.empty">No history yet. Generate some prompts!</div>
            </div>
        </div>
        <div class="history-footer">
            <button class="history-clear-btn" onclick="clearHistory()" data-translate="history.clearAll">
                ðŸ—‘ï¸ Clear All History
            </button>
        </div>
    </div>

    <script>
        let currentProject = null;
        let selectedImages = [];
        let selectedStyle = '';
        let selectedRatio = '1:1';
        let selectedProduct = '';
        let selectedShapes = [];
        let selectedPhotoStyle = null;
        let turboMode = false;

        // Turbo Mode Toggle Function
        function toggleTurboMode(enabled) {
            turboMode = enabled;
            const turboCard = document.getElementById('turboCard');
            const turboInfo = document.getElementById('turboInfo');
            const generateBtn = document.getElementById('generateBtn');
            const generateBtnIcon = document.getElementById('generateBtnIcon');
            const generateBtnText = document.getElementById('generateBtnText');

            if (enabled) {
                turboCard.classList.add('turbo-active');
                turboInfo.style.display = 'block';
                generateBtn.classList.add('btn-turbo');
                generateBtnIcon.textContent = 'âš¡';
                generateBtnText.textContent = translations[currentLanguage].generateBtn.turboText || 'Generate TURBO Prompts';
            } else {
                turboCard.classList.remove('turbo-active');
                turboInfo.style.display = 'none';
                generateBtn.classList.remove('btn-turbo');
                generateBtnIcon.textContent = 'âœ¨';
                generateBtnText.textContent = translations[currentLanguage].generateBtn.text;
            }
        }

        // AI Instructions Analyzer
        let aiInstructionImages = [];

        function handleAiImages(files) {
            for (const file of files) {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        aiInstructionImages.push({
                            dataUrl: e.target.result,
                            file: file
                        });
                        updateAiPreview();
                    };
                    reader.readAsDataURL(file);
                }
            }
        }

        function updateAiPreview() {
            const preview = document.getElementById('aiImagePreview');
            const analyzeSection = document.getElementById('aiAnalyzeSection');

            preview.innerHTML = aiInstructionImages.map((img, index) => `
                <div class="ai-preview-item">
                    <img src="${img.dataUrl}" alt="Instruction ${index + 1}">
                    <button class="ai-preview-remove" onclick="removeAiImage(${index})">Ã—</button>
                </div>
            `).join('');

            analyzeSection.style.display = aiInstructionImages.length > 0 ? 'flex' : 'none';
        }

        function removeAiImage(index) {
            aiInstructionImages.splice(index, 1);
            updateAiPreview();
        }

        function clearAiImages() {
            aiInstructionImages = [];
            updateAiPreview();
            document.getElementById('aiAnalyzeStatus').style.display = 'none';
        }

        async function pasteAiImage(event) {
            event.stopPropagation();
            try {
                const clipboardItems = await navigator.clipboard.read();
                for (const item of clipboardItems) {
                    for (const type of item.types) {
                        if (type.startsWith('image/')) {
                            const blob = await item.getType(type);
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                aiInstructionImages.push({
                                    dataUrl: e.target.result,
                                    file: new File([blob], `pasted-${Date.now()}.png`, { type: type })
                                });
                                updateAiPreview();
                            };
                            reader.readAsDataURL(blob);
                            return;
                        }
                    }
                }
                alert(translations[currentLanguage].aiAnalyzer?.noImageInClipboard || 'No image found in clipboard. Copy an image first!');
            } catch (err) {
                console.error('Paste error:', err);
                alert(translations[currentLanguage].aiAnalyzer?.pasteError || 'Could not paste. Make sure you have an image copied.');
            }
        }

        async function analyzeInstructions() {
            if (aiInstructionImages.length === 0) return;

            const btn = document.getElementById('aiAnalyzeBtn');
            const status = document.getElementById('aiAnalyzeStatus');

            btn.classList.add('analyzing');
            btn.innerHTML = '<span class="ai-btn-icon">â³</span> <span>' + (translations[currentLanguage].aiAnalyzer?.analyzing || 'Analyzing...') + '</span>';

            status.style.display = 'block';
            status.className = 'ai-analyze-status loading';
            status.textContent = translations[currentLanguage].aiAnalyzer?.analyzing || 'ðŸ¤– Analyzing instructions... Please wait';

            try {
                const formData = new FormData();
                aiInstructionImages.forEach((img, index) => {
                    const blob = dataURLtoBlob(img.dataUrl);
                    formData.append('images', blob, `instruction-${index}.png`);
                });

                const response = await fetch('/api/analyze-instructions', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    // Auto-fill the form fields
                    autoFillFields(result.data);

                    status.className = 'ai-analyze-status success';
                    status.textContent = translations[currentLanguage].aiAnalyzer?.success || 'âœ… Fields auto-filled! Review and adjust if needed';
                } else {
                    throw new Error(result.error || 'Analysis failed');
                }
            } catch (error) {
                console.error('Analysis error:', error);
                status.className = 'ai-analyze-status error';
                status.textContent = translations[currentLanguage].aiAnalyzer?.error || 'âŒ Could not analyze. Please try again or fill manually';
            }

            btn.classList.remove('analyzing');
            btn.innerHTML = '<span class="ai-btn-icon">ðŸ¤–</span> <span>' + (translations[currentLanguage].aiAnalyzer?.analyzeBtn || 'Analyze & Auto-Fill All Fields') + '</span>';
        }

        function autoFillFields(data) {
            console.log('ðŸ¤– Auto-filling fields with data:', data);

            // Fill instructions textarea
            if (data.instructions) {
                document.getElementById('instructions').value = data.instructions;
            }

            // Fill destination if field exists
            if (data.destination) {
                const destField = document.getElementById('destination');
                if (destField) destField.value = data.destination;
            }

            // Fill theme if field exists
            if (data.theme) {
                const themeField = document.getElementById('theme');
                if (themeField) themeField.value = data.theme;
            }

            // Select style using the selectStyle function
            if (data.style && typeof selectStyle === 'function') {
                try {
                    selectStyle(data.style);
                    console.log('âœ… Style set to:', data.style);
                } catch (e) {
                    console.log('Style button not found:', data.style);
                }
            }

            // Select ratio using the selectRatio function
            if (data.ratio && typeof selectRatio === 'function') {
                try {
                    selectRatio(data.ratio);
                    console.log('âœ… Ratio set to:', data.ratio);
                } catch (e) {
                    console.log('Ratio button not found:', data.ratio);
                }
            }

            // Select product type using the selectProduct function
            if (data.productType && typeof selectProduct === 'function') {
                try {
                    selectProduct(data.productType);
                    console.log('âœ… Product set to:', data.productType);
                } catch (e) {
                    console.log('Product button not found:', data.productType);
                }
            }

            // Set decoration level if detected
            if (data.decorationLevel) {
                const decorSlider = document.getElementById('decorationLevel');
                if (decorSlider) {
                    decorSlider.value = data.decorationLevel;
                    decorSlider.dispatchEvent(new Event('input'));
                    console.log('âœ… Decoration level set to:', data.decorationLevel);
                }
            }

            // Set transformeter level if detected (for variations project)
            if (data.transformeterLevel) {
                const transSlider = document.getElementById('levelSlider');
                if (transSlider) {
                    transSlider.value = data.transformeterLevel;
                    transSlider.dispatchEvent(new Event('input'));
                    console.log('âœ… Transformeter level set to:', data.transformeterLevel);
                }
            }

            // Set crazymeter if detected (for from-scratch and previous-element projects)
            if (data.crazymeter) {
                const crazySlider = document.getElementById('crazymeter');
                if (crazySlider) {
                    crazySlider.value = data.crazymeter;
                    crazySlider.dispatchEvent(new Event('input'));
                    console.log('âœ… Crazymeter set to:', data.crazymeter);
                }
            }

            // Set variation count if detected
            if (data.variationCount) {
                const varInput = document.getElementById('variationCount');
                if (varInput) {
                    varInput.value = data.variationCount;
                    varInput.dispatchEvent(new Event('input'));
                    console.log('âœ… Variation count set to:', data.variationCount);
                }
            }

            // Select photo style using the selectPhotoStyle function
            if (data.photoStyle && typeof selectPhotoStyle === 'function') {
                try {
                    selectPhotoStyle(data.photoStyle);
                    console.log('âœ… Photo style set to:', data.photoStyle);
                } catch (e) {
                    console.log('Photo style not found:', data.photoStyle);
                }
            }

            // Scroll to instructions to show the filled content
            document.getElementById('instructions').scrollIntoView({ behavior: 'smooth', block: 'center' });

            // Highlight the instructions field briefly
            const instructionsField = document.getElementById('instructions');
            instructionsField.style.transition = 'box-shadow 0.3s ease';
            instructionsField.style.boxShadow = '0 0 0 4px rgba(0, 188, 212, 0.4)';
            setTimeout(() => {
                instructionsField.style.boxShadow = '';
            }, 2000);
        }

        // Drag and drop for AI analyzer
        document.addEventListener('DOMContentLoaded', () => {
            const aiUploadZone = document.getElementById('aiUploadZone');
            if (aiUploadZone) {
                aiUploadZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    aiUploadZone.classList.add('drag-over');
                });
                aiUploadZone.addEventListener('dragleave', () => {
                    aiUploadZone.classList.remove('drag-over');
                });
                aiUploadZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    aiUploadZone.classList.remove('drag-over');
                    handleAiImages(e.dataTransfer.files);
                });
            }
        });

        let currentLanguage = 'en';

        // Translations object
        const translations = {
            en: {
                header: {
                    tagline: 'Design Prompt Generator',
                    selectProject: 'Select Project'
                },
                projectCard: {
                    title: 'Choose Your Project Type',
                    description: 'Select the type of design project you want to work on'
                },
                instructionsCard: {
                    title: 'What Would You Like to Create?',
                    description: 'Describe your design idea in detail',
                    placeholder: "Describe what you want... For example: 'Create a variation with the Ãngel swimming in water with marine decorations' or 'Change the character's clothing to traditional Mexican dress'",
                    help: 'Be as specific as possible about what you want to change or create'
                },
                template: {
                    title: 'ðŸ“‹ Quick Template',
                    copyBtn: 'Copy'
                },
                variationCard: {
                    title: 'Number of Variations',
                    description: 'Each variation will be generated with a unique approach',
                    help: 'Generate between 1 and 10 unique variations'
                },
                imageCard: {
                    title: 'Reference Images (Optional)',
                    description: 'Upload images to guide the design generation',
                    uploadText: 'Click to upload or paste images',
                    uploadHint: 'PNG, JPG, or GIF - Add as many as you need!',
                    pasteHint: '<strong>Pro Tip:</strong> Copy an image and press <kbd>Cmd+V</kbd> (Mac) or <kbd>Ctrl+V</kbd> (Windows) anywhere on this page to add it!',
                    imagesAttached: 'image(s) attached',
                    clearAll: 'Clear All',
                    persistNote: 'Images will be used for all generations until you remove them'
                },
                generateBtn: {
                    text: 'Generate Design Prompts',
                    turboText: 'Generate TURBO Prompts âš¡'
                },
                turboCard: {
                    title: 'Turbo Mode',
                    description: 'Generate ultra-fast short prompts (max 250 words)',
                    activeMessage: 'âš¡ Turbo active: Prompts will be hyper-optimized for speed (~250 words)'
                },
                aiAnalyzer: {
                    title: 'AI Instructions Analyzer',
                    description: 'Upload client screenshots or instructions - AI will fill all fields automatically',
                    uploadText: 'Drop or click to upload client instructions',
                    uploadHint: 'WhatsApp screenshots, emails, handwritten notes, etc.',
                    pasteBtn: 'Paste Image from Clipboard',
                    noImageInClipboard: 'No image found in clipboard. Copy an image first!',
                    pasteError: 'Could not paste. Make sure you have an image copied.',
                    analyzeBtn: 'Analyze & Auto-Fill All Fields',
                    clearBtn: 'Clear',
                    analyzing: 'ðŸ¤– Analyzing instructions... Please wait',
                    success: 'âœ… Fields auto-filled! Review and adjust if needed',
                    error: 'âŒ Could not analyze. Please try again or fill manually'
                },
                outputCard: {
                    title: 'Generated Prompts',
                    description: 'Copy and use these prompts in your design tool'
                },
                settings: {
                    title: 'âš™ï¸ Settings',
                    apiKeyLabel: 'Claude API Key (Optional)',
                    apiKeyHelp: 'Add your Anthropic API key to enable automatic prompt generation. Leave empty to use template mode.',
                    saveBtn: 'Save Settings'
                },
                styleCard: {
                    title: 'Choose a Style',
                    description: 'Select an artistic style for your design',
                    noStyle: 'No Style - Keep Original'
                },
                ratioCard: {
                    title: 'Image Ratio',
                    description: 'Choose the aspect ratio for your design',
                    square: '1:1 Square',
                    rectangular: '2:1 Rectangular'
                },
                productCard: {
                    title: 'Product Type',
                    description: "Select the type of product you're designing for",
                    magnet: 'Magnet',
                    keychain: 'Keychain',
                    bottleOpener: 'Bottle Opener',
                    shapeTitle: 'Select Bottle Opener Shape',
                    verticalShape: 'Vertical Shape',
                    horizontalShape: 'Horizontal Shape',
                    shapeHelp: 'Click one or more shapes - they will be added to your reference images automatically'
                },
                photoStyleCard: {
                    title: 'Photography Design Style',
                    help: 'Choose how real photography should be incorporated into the design',
                    clippingMask: 'Clipping Mask',
                    clippingMaskDesc: 'Photo placed INSIDE a regional shape (animal, landmark). The photograph becomes the texture/fill of an iconic silhouette.',
                    decorativeFrame: 'Decorative Frame',
                    decorativeFrameDesc: 'Photo centered in ornamental frame, surrounded by illustrated regional elements (flora, fauna, cultural icons).'
                },
                parametersCard: {
                    title: 'Project Parameters',
                    description: 'Provide details about your design requirements',
                    destination: 'Destination *',
                    destinationPlaceholder: 'e.g., Hermosillo, CDMX',
                    theme: 'Theme',
                    themePlaceholder: 'e.g., Christmas, Summer',
                    elementDescription: 'Previous Element Description',
                    elementPlaceholder: 'Describe the element to build from',
                    transformeterLevel: 'Transformeter Level:',
                    transformeterHelp: '1-3: Minor changes | 4-6: Moderate changes | 7-10: Major transformation',
                    decorationLevel: 'Decoration Level:',
                    decorationHelp: 'How much decorative detail to include (1: minimal, 10: maximum)',
                    crazymeterLevel: 'Crazymeter Level:',
                    crazymeterHelp: '1-3: Traditional designs | 4-6: Creative twists | 7-10: Wild, unconventional ideas'
                },
                modifyCard: {
                    title: 'Modification Instructions',
                    description: 'Upload the design you want to modify, then describe the changes in the instructions field'
                },
                projects: {
                    variations: 'Generate Variations from an Existing Design',
                    fromscratch: 'Create a New Design from Scratch',
                    previouselement: 'Design Using a Previous Element as a Base',
                    modify: 'Modify an Existing Design'
                },
                alerts: {
                    selectProject: 'Please select a project first!',
                    provideInstructions: 'Please provide instructions for what you want to create!',
                    variationRange: 'Please enter a number between 1 and 10 for variations',
                    clearImages: 'Remove all images and shape references? You can add them again anytime.',
                    settingsSaved: 'Settings saved! The app will now use Claude API for intelligent prompt generation.',
                    settingsSavedTemplate: 'Settings saved! The app will use template mode.'
                },
                loading: {
                    starting: 'Starting generation of',
                    variation: 'variation',
                    variations: 'variations',
                    willAppear: 'Variations will appear below as they complete',
                    generating: 'Generating',
                    complete: 'complete'
                },
                variationTitle: 'Variation',
                copyToClipboard: 'Copy to Clipboard',
                copied: 'âœ“ Copied!',
                history: {
                    title: 'Generation History',
                    empty: 'No history yet. Generate some prompts!',
                    clearAll: 'ðŸ—‘ï¸ Clear All History',
                    copy: 'Copy',
                    reuse: 'Reuse',
                    delete: 'Delete',
                    confirmClear: 'Are you sure you want to clear all history? This cannot be undone.',
                    confirmDelete: 'Delete this item from history?',
                    copiedFromHistory: 'âœ“ Copied from history!',
                    settingsLoaded: 'âœ“ Settings loaded! Review the form and click Generate.'
                }
            },
            es: {
                header: {
                    tagline: 'Generador de Prompts de DiseÃ±o',
                    selectProject: 'Seleccionar Proyecto'
                },
                projectCard: {
                    title: 'Elige tu Tipo de Proyecto',
                    description: 'Selecciona el tipo de proyecto de diseÃ±o en el que quieres trabajar'
                },
                instructionsCard: {
                    title: 'Â¿QuÃ© te GustarÃ­a Crear?',
                    description: 'Describe tu idea de diseÃ±o en detalle',
                    placeholder: "Describe lo que quieres... Por ejemplo: 'Crea una variaciÃ³n con el Ãngel nadando en agua con decoraciones marinas' o 'Cambia la ropa del personaje a vestimenta tradicional mexicana'",
                    help: 'SÃ© lo mÃ¡s especÃ­fico posible sobre lo que quieres cambiar o crear'
                },
                template: {
                    title: 'ðŸ“‹ Plantilla RÃ¡pida',
                    copyBtn: 'Copiar'
                },
                variationCard: {
                    title: 'NÃºmero de Variaciones',
                    description: 'Cada variaciÃ³n se generarÃ¡ con un enfoque Ãºnico',
                    help: 'Genera entre 1 y 10 variaciones Ãºnicas'
                },
                imageCard: {
                    title: 'ImÃ¡genes de Referencia (Opcional)',
                    description: 'Sube imÃ¡genes para guiar la generaciÃ³n del diseÃ±o',
                    uploadText: 'Haz clic para subir o pegar imÃ¡genes',
                    uploadHint: 'PNG, JPG o GIF - Â¡Agrega tantas como necesites!',
                    pasteHint: '<strong>Consejo:</strong> Copia una imagen y presiona <kbd>Cmd+V</kbd> (Mac) o <kbd>Ctrl+V</kbd> (Windows) en cualquier lugar de esta pÃ¡gina para agregarla!',
                    imagesAttached: 'imagen(es) adjunta(s)',
                    clearAll: 'Limpiar Todo',
                    persistNote: 'Las imÃ¡genes se usarÃ¡n para todas las generaciones hasta que las elimines'
                },
                generateBtn: {
                    text: 'Generar Prompts de DiseÃ±o',
                    turboText: 'Generar Prompts TURBO âš¡'
                },
                turboCard: {
                    title: 'Modo Turbo',
                    description: 'Genera prompts ultra-rÃ¡pidos y cortos (mÃ¡x 250 palabras)',
                    activeMessage: 'âš¡ Turbo activo: Los prompts serÃ¡n hiper-optimizados para velocidad (~250 palabras)'
                },
                aiAnalyzer: {
                    title: 'Analizador de Instrucciones IA',
                    description: 'Sube capturas de pantalla o instrucciones del cliente - la IA llenarÃ¡ todos los campos automÃ¡ticamente',
                    uploadText: 'Arrastra o haz clic para subir instrucciones del cliente',
                    uploadHint: 'Capturas de WhatsApp, emails, notas escritas a mano, etc.',
                    pasteBtn: 'Pegar Imagen del Portapapeles',
                    noImageInClipboard: 'Â¡No se encontrÃ³ imagen en el portapapeles. Copia una imagen primero!',
                    pasteError: 'No se pudo pegar. AsegÃºrate de tener una imagen copiada.',
                    analyzeBtn: 'Analizar y Auto-Llenar Todos los Campos',
                    clearBtn: 'Limpiar',
                    analyzing: 'ðŸ¤– Analizando instrucciones... Por favor espera',
                    success: 'âœ… Â¡Campos auto-llenados! Revisa y ajusta si es necesario',
                    error: 'âŒ No se pudo analizar. Intenta de nuevo o llena manualmente'
                },
                outputCard: {
                    title: 'Prompts Generados',
                    description: 'Copia y usa estos prompts en tu herramienta de diseÃ±o'
                },
                settings: {
                    title: 'âš™ï¸ ConfiguraciÃ³n',
                    apiKeyLabel: 'Clave API de Claude (Opcional)',
                    apiKeyHelp: 'Agrega tu clave API de Anthropic para habilitar la generaciÃ³n automÃ¡tica de prompts. DÃ©jala vacÃ­a para usar el modo de plantilla.',
                    saveBtn: 'Guardar ConfiguraciÃ³n'
                },
                styleCard: {
                    title: 'Elige un Estilo',
                    description: 'Selecciona un estilo artÃ­stico para tu diseÃ±o',
                    noStyle: 'Sin Estilo - Mantener Original'
                },
                ratioCard: {
                    title: 'ProporciÃ³n de Imagen',
                    description: 'Elige la relaciÃ³n de aspecto para tu diseÃ±o',
                    square: '1:1 Cuadrado',
                    rectangular: '2:1 Rectangular'
                },
                productCard: {
                    title: 'Tipo de Producto',
                    description: 'Selecciona el tipo de producto para el que estÃ¡s diseÃ±ando',
                    magnet: 'ImÃ¡n',
                    keychain: 'Llavero',
                    bottleOpener: 'Abrebotellas',
                    shapeTitle: 'Seleccionar Forma de Abrebotellas',
                    verticalShape: 'Forma Vertical',
                    horizontalShape: 'Forma Horizontal',
                    shapeHelp: 'Haz clic en una o mÃ¡s formas - se agregarÃ¡n automÃ¡ticamente a tus imÃ¡genes de referencia'
                },
                photoStyleCard: {
                    title: 'Estilo de DiseÃ±o FotogrÃ¡fico',
                    help: 'Elige cÃ³mo se debe incorporar la fotografÃ­a real en el diseÃ±o',
                    clippingMask: 'MÃ¡scara de Recorte',
                    clippingMaskDesc: 'Foto colocada DENTRO de una forma regional (animal, monumento). La fotografÃ­a se convierte en la textura/relleno de una silueta icÃ³nica.',
                    decorativeFrame: 'Marco Decorativo',
                    decorativeFrameDesc: 'Foto centrada en un marco ornamental, rodeada de elementos regionales ilustrados (flora, fauna, iconos culturales).'
                },
                parametersCard: {
                    title: 'ParÃ¡metros del Proyecto',
                    description: 'Proporciona detalles sobre los requisitos de tu diseÃ±o',
                    destination: 'Destino *',
                    destinationPlaceholder: 'ej., Hermosillo, CDMX',
                    theme: 'Tema',
                    themePlaceholder: 'ej., Navidad, Verano',
                    elementDescription: 'DescripciÃ³n del Elemento Anterior',
                    elementPlaceholder: 'Describe el elemento del cual partir',
                    transformeterLevel: 'Nivel de TransformaciÃ³n:',
                    transformeterHelp: '1-3: Cambios menores | 4-6: Cambios moderados | 7-10: TransformaciÃ³n mayor',
                    decorationLevel: 'Nivel de DecoraciÃ³n:',
                    decorationHelp: 'CuÃ¡nto detalle decorativo incluir (1: mÃ­nimo, 10: mÃ¡ximo)',
                    crazymeterLevel: 'Nivel de Locura:',
                    crazymeterHelp: '1-3: DiseÃ±os tradicionales | 4-6: Toques creativos | 7-10: Ideas salvajes y poco convencionales'
                },
                modifyCard: {
                    title: 'Instrucciones de ModificaciÃ³n',
                    description: 'Sube el diseÃ±o que quieres modificar, luego describe los cambios en el campo de instrucciones'
                },
                projects: {
                    variations: 'Generar Variaciones de un DiseÃ±o Existente',
                    fromscratch: 'Crear un Nuevo DiseÃ±o desde Cero',
                    previouselement: 'DiseÃ±ar Usando un Elemento Anterior como Base',
                    modify: 'Modificar un DiseÃ±o Existente'
                },
                alerts: {
                    selectProject: 'Â¡Por favor selecciona un proyecto primero!',
                    provideInstructions: 'Â¡Por favor proporciona instrucciones sobre lo que quieres crear!',
                    variationRange: 'Por favor ingresa un nÃºmero entre 1 y 10 para las variaciones',
                    clearImages: 'Â¿Eliminar todas las imÃ¡genes y referencias de formas? Puedes agregarlas de nuevo en cualquier momento.',
                    settingsSaved: 'Â¡ConfiguraciÃ³n guardada! La aplicaciÃ³n ahora usarÃ¡ la API de Claude para generaciÃ³n inteligente de prompts.',
                    settingsSavedTemplate: 'Â¡ConfiguraciÃ³n guardada! La aplicaciÃ³n usarÃ¡ el modo de plantilla.'
                },
                loading: {
                    starting: 'Iniciando generaciÃ³n de',
                    variation: 'variaciÃ³n',
                    variations: 'variaciones',
                    willAppear: 'Las variaciones aparecerÃ¡n abajo a medida que se completen',
                    generating: 'Generando',
                    complete: 'completada(s)'
                },
                variationTitle: 'VariaciÃ³n',
                copyToClipboard: 'Copiar al Portapapeles',
                copied: 'âœ“ Â¡Copiado!',
                history: {
                    title: 'Historial de Generaciones',
                    empty: 'Sin historial aÃºn. Â¡Genera algunos prompts!',
                    clearAll: 'ðŸ—‘ï¸ Borrar Todo el Historial',
                    copy: 'Copiar',
                    reuse: 'Reusar',
                    delete: 'Eliminar',
                    confirmClear: 'Â¿EstÃ¡s seguro de que quieres borrar todo el historial? Esto no se puede deshacer.',
                    confirmDelete: 'Â¿Eliminar este elemento del historial?',
                    copiedFromHistory: 'âœ“ Â¡Copiado del historial!',
                    settingsLoaded: 'âœ“ Â¡ConfiguraciÃ³n cargada! Revisa el formulario y haz clic en Generar.'
                }
            }
        };

        // Language switcher function
        function setLanguage(lang) {
            currentLanguage = lang;

            // Update button states
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('lang-' + lang).classList.add('active');

            // Translate all elements with data-translate attribute
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                const keys = key.split('.');
                let translation = translations[lang];

                for (const k of keys) {
                    translation = translation[k];
                    if (!translation) break;
                }

                if (translation) {
                    element.innerHTML = translation;
                }
            });

            // Translate placeholders
            document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                const keys = key.split('.');
                let translation = translations[lang];

                for (const k of keys) {
                    translation = translation[k];
                    if (!translation) break;
                }

                if (translation) {
                    element.placeholder = translation;
                }
            });

            console.log('Language changed to:', lang);

            // Store in localStorage
            localStorage.setItem('language', lang);
        }

        // Shape reference data
        const shapeReferences = {
            'shape-1': {
                path: '/presets/bottle-opener-shape-1.png',
                name: 'Vertical Bottle Opener Shape',
                type: 'shape-reference'
            },
            'shape-2': {
                path: '/presets/bottle-opener-shape-2.png',
                name: 'Horizontal Bottle Opener Shape',
                type: 'shape-reference'
            }
        };

        const stylePresets = [
            { value: 'cartoon', label: 'ðŸŽ¨ Cartoon', description: 'Modern illustrative style with clean vector shapes, bold outlines, and sophisticated compositions' },
            { value: 'realistic', label: 'ðŸ–¼ï¸ Realistic', description: 'Detailed realistic illustration with natural colors and textures' },
            { value: 'collage', label: 'âœ‚ï¸ Collage', description: 'Mixed media collage with layered elements, textures, and cutout style' },
            { value: 'photography', label: 'ðŸ“¸ Photography', description: 'Photography-based designs with real photo elements integrated into the composition' },
            { value: 'secret', label: 'ðŸŽ² Secret Style', description: 'Randomly chosen from unique artistic styles - surprise me!' }
        ];

        // Secret styles that will be randomly selected
        const secretStyles = [
            'destination badge style with flat illustration, layered elements, dimensional typography, and decorative framing',
            'photo collage with mixed media - combining real photography of landmarks/objects with illustrated cartoon characters, decorative pattern backgrounds, and vibrant dimensional typography'
        ];

        function renderStylePresets(includeNoStyle = false) {
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span>ðŸŽ¨</span>
                            <span data-translate="styleCard.title">Choose a Style</span>
                        </h3>
                        <p class="card-description" data-translate="styleCard.description">Select an artistic style for your design</p>
                    </div>
                    ${includeNoStyle ? `
                    <div style="margin-bottom: 20px;">
                        <button type="button" class="style-pill no-style" onclick="selectStyle('none')" id="style-none" title="Generate without applying any specific style - use the original design's style" style="width: 100%;">
                            <span>ðŸš«</span>
                            <span data-translate="styleCard.noStyle">No Style - Keep Original</span>
                        </button>
                    </div>
                    ` : ''}
                    <div class="style-pills">
                        ${stylePresets.map(style => `
                            <button type="button" class="style-pill" onclick="selectStyle('${style.value}')" id="style-${style.value}" title="${style.description}">
                                ${style.label}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderRatioButtons() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span>ðŸ“</span>
                            <span data-translate="ratioCard.title">Image Ratio</span>
                        </h3>
                        <p class="card-description" data-translate="ratioCard.description">Choose the aspect ratio for your design</p>
                    </div>
                    <div class="ratio-group">
                        <button type="button" class="ratio-btn active" onclick="selectRatio('1:1')" id="ratio-1-1">
                            <span class="ratio-icon">â¬œ</span>
                            <span data-translate="ratioCard.square">1:1 Square</span>
                        </button>
                        <button type="button" class="ratio-btn" onclick="selectRatio('2:1')" id="ratio-2-1">
                            <span class="ratio-icon">â–­</span>
                            <span data-translate="ratioCard.rectangular">2:1 Rectangular</span>
                        </button>
                    </div>
                </div>
            `;
        }

        function updatePhotoStyleSelectorVisibility() {
            const photoStyleSelector = document.getElementById('photoStyleSelector');
            if (photoStyleSelector) {
                if (currentProject === 'previous-element' && selectedStyle === 'photography') {
                    photoStyleSelector.classList.add('visible');
                } else {
                    photoStyleSelector.classList.remove('visible');
                }
            }
        }

        function selectStyle(style) {
            if (style === 'secret') {
                const randomIndex = Math.floor(Math.random() * secretStyles.length);
                selectedStyle = secretStyles[randomIndex];
                console.log('Secret style selected:', selectedStyle);
            } else if (style === 'none') {
                selectedStyle = '';
                console.log('No style selected - keeping original design style');
            } else {
                selectedStyle = style;
            }
            document.querySelectorAll('.style-pill').forEach(btn => btn.classList.remove('active'));
            document.getElementById('style-' + style).classList.add('active');

            // Update photo style selector visibility
            updatePhotoStyleSelectorVisibility();
        }

        function selectRatio(ratio) {
            selectedRatio = ratio;
            document.querySelectorAll('.ratio-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('ratio-' + ratio.replace(':', '-')).classList.add('active');
        }

        function selectProduct(product) {
            selectedProduct = product;

            document.querySelectorAll('.product-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('product-' + product).classList.add('active');

            const shapeGallery = document.getElementById('shapeGallery');
            if (product === 'bottle-opener') {
                shapeGallery.classList.add('visible');
                console.log('Bottle opener selected - shape constraints will be applied');
            } else {
                shapeGallery.classList.remove('visible');
                console.log(product + ' selected');
            }
        }

        function selectPhotoStyle(style) {
            selectedPhotoStyle = style;

            document.querySelectorAll('.style-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.getElementById('style-' + style).classList.add('selected');

            console.log('Photography style selected:', style);
        }

        async function copyTemplate() {
            const templateText = document.getElementById('templateText').textContent;
            await navigator.clipboard.writeText(templateText);

            const btn = document.querySelector('.template-copy-btn');
            const originalText = btn.textContent;
            btn.textContent = 'âœ“ Copied!';
            btn.classList.add('copied');

            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('copied');
            }, 2000);
        }

        async function toggleShapeSelection(shapeId) {
            const shapeOption = document.getElementById('shape-option-' + shapeId.split('-')[1]);
            const shapeData = shapeReferences[shapeId];

            if (!shapeData) return;

            const isSelected = shapeOption.classList.contains('selected');

            if (isSelected) {
                shapeOption.classList.remove('selected');
                selectedShapes = selectedShapes.filter(s => s.id !== shapeId);

                const preview = document.getElementById('imagePreview');
                const existingShape = preview.querySelector(`[data-shape-id="${shapeId}"]`);
                if (existingShape) {
                    existingShape.remove();
                }
            } else {
                shapeOption.classList.add('selected');

                try {
                    const response = await fetch(shapeData.path);
                    const blob = await response.blob();
                    const file = new File([blob], shapeData.name + '.png', { type: 'image/png' });

                    selectedShapes.push({
                        id: shapeId,
                        file: file,
                        name: shapeData.name
                    });

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        addShapeToPreview(e.target.result, shapeId, shapeData.name);
                    };
                    reader.readAsDataURL(file);
                } catch (error) {
                    console.error('Error loading shape image:', error);
                    alert('Failed to load shape image. Please try again.');
                }
            }

            updateImageCount();
        }

        function addShapeToPreview(src, shapeId, name) {
            const preview = document.getElementById('imagePreview');

            const container = document.createElement('div');
            container.className = 'preview-img-container';
            container.dataset.shapeId = shapeId;

            const img = document.createElement('img');
            img.src = src;
            img.className = 'preview-img';
            img.title = name;

            const removeBtn = document.createElement('div');
            removeBtn.className = 'remove-img-btn';
            removeBtn.innerHTML = 'Ã—';
            removeBtn.title = 'Remove shape reference';
            removeBtn.onclick = (e) => {
                e.stopPropagation();
                removeShapeReference(shapeId);
            };

            const label = document.createElement('div');
            label.style.cssText = 'position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(135deg, var(--axkan-turquoise), var(--axkan-green)); color: white; padding: 6px; font-size: 11px; text-align: center; font-weight: 600;';
            label.textContent = 'ðŸ“ Shape Reference';

            container.appendChild(img);
            container.appendChild(removeBtn);
            container.appendChild(label);
            preview.appendChild(container);
        }

        function removeShapeReference(shapeId) {
            selectedShapes = selectedShapes.filter(s => s.id !== shapeId);

            const preview = document.getElementById('imagePreview');
            const existingShape = preview.querySelector(`[data-shape-id="${shapeId}"]`);
            if (existingShape) {
                existingShape.remove();
            }

            const shapeOption = document.getElementById('shape-option-' + shapeId.split('-')[1]);
            if (shapeOption) {
                shapeOption.classList.remove('selected');
            }

            updateImageCount();
        }

        function renderProductSelector() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span>ðŸŽ</span>
                            <span data-translate="productCard.title">Product Type</span>
                        </h3>
                        <p class="card-description" data-translate="productCard.description">Select the type of product you're designing for</p>
                    </div>
                    <div class="product-grid">
                        <button type="button" class="product-btn" onclick="selectProduct('magnet')" id="product-magnet">
                            <span class="product-icon">ðŸ§²</span>
                            <span class="product-label" data-translate="productCard.magnet">Magnet</span>
                        </button>
                        <button type="button" class="product-btn disabled" id="product-keychain">
                            <span class="product-icon">ðŸ”‘</span>
                            <span class="product-label" data-translate="productCard.keychain">Keychain</span>
                        </button>
                        <button type="button" class="product-btn" onclick="selectProduct('bottle-opener')" id="product-bottle-opener">
                            <span class="product-icon">ðŸº</span>
                            <span class="product-label" data-translate="productCard.bottleOpener">Bottle Opener</span>
                        </button>
                    </div>

                    <div class="shape-gallery" id="shapeGallery">
                        <div class="shape-gallery-title">
                            <span>ðŸ“</span>
                            <span data-translate="productCard.shapeTitle">Select Bottle Opener Shape</span>
                        </div>
                        <div class="shape-grid">
                            <div class="shape-option" onclick="toggleShapeSelection('shape-1')" id="shape-option-1">
                                <div class="shape-checkmark">âœ“</div>
                                <img src="/presets/bottle-opener-shape-1.png" alt="Bottle Opener Shape 1">
                                <div class="shape-label" data-translate="productCard.verticalShape">Vertical Shape</div>
                            </div>
                            <div class="shape-option" onclick="toggleShapeSelection('shape-2')" id="shape-option-2">
                                <div class="shape-checkmark">âœ“</div>
                                <img src="/presets/bottle-opener-shape-2.png" alt="Bottle Opener Shape 2">
                                <div class="shape-label" data-translate="productCard.horizontalShape">Horizontal Shape</div>
                            </div>
                        </div>
                        <div class="form-help" style="margin-top: 16px;">
                            <span>ðŸ’¡</span>
                            <span data-translate="productCard.shapeHelp">Click one or more shapes - they will be added to your reference images automatically</span>
                        </div>
                    </div>

                    <div class="photo-style-selector" id="photoStyleSelector">
                        <div class="photo-style-title">
                            <span>ðŸ“¸</span>
                            <span data-translate="photoStyleCard.title">Photography Design Style</span>
                        </div>
                        <div class="form-help" style="margin-bottom: 16px; color: #E65100;">
                            <span>âš ï¸</span>
                            <span data-translate="photoStyleCard.help">Choose how real photography should be incorporated into the design</span>
                        </div>
                        <div class="style-options">
                            <div class="style-option" onclick="selectPhotoStyle('clipping-mask')" id="style-clipping-mask">
                                <div class="style-radio"></div>
                                <div class="style-option-icon">ðŸ¦Œ</div>
                                <div class="style-option-label" data-translate="photoStyleCard.clippingMask">Clipping Mask</div>
                                <div class="style-option-description" data-translate="photoStyleCard.clippingMaskDesc">
                                    Photo placed INSIDE a regional shape (animal, landmark). The photograph becomes the texture/fill of an iconic silhouette.
                                </div>
                            </div>
                            <div class="style-option" onclick="selectPhotoStyle('decorative-frame')" id="style-decorative-frame">
                                <div class="style-radio"></div>
                                <div class="style-option-icon">ðŸ–¼ï¸</div>
                                <div class="style-option-label" data-translate="photoStyleCard.decorativeFrame">Decorative Frame</div>
                                <div class="style-option-description" data-translate="photoStyleCard.decorativeFrameDesc">
                                    Photo centered in ornamental frame, surrounded by illustrated regional elements (flora, fauna, cultural icons).
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        const projectFields = {
            'variations': `
                ${renderProductSelector()}
                ${renderStylePresets(true)}
                ${renderRatioButtons()}
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span>ðŸŽ¯</span>
                            <span data-translate="parametersCard.title">Project Parameters</span>
                        </h3>
                        <p class="card-description" data-translate="parametersCard.description">Provide details about your design requirements</p>
                    </div>
                    <div class="optional-fields">
                        <div class="form-group">
                            <label class="form-label" for="destination" data-translate="parametersCard.destination">Destination *</label>
                            <input type="text" id="destination" class="form-input" data-translate-placeholder="parametersCard.destinationPlaceholder" placeholder="e.g., Hermosillo, CDMX" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="theme" data-translate="parametersCard.theme">Theme</label>
                            <input type="text" id="theme" class="form-input" data-translate-placeholder="parametersCard.themePlaceholder" placeholder="e.g., Christmas, Summer">
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="form-group">
                        <label class="form-label"><span data-translate="parametersCard.transformeterLevel">Transformeter Level:</span> <span class="slider-value" id="levelValue">5</span></label>
                        <div class="slider-container">
                            <input type="range" min="1" max="10" value="5" class="slider" id="level" oninput="updateSlider('level', 'levelValue')">
                        </div>
                        <div class="form-help">
                            <span>ðŸ“Š</span>
                            <span data-translate="parametersCard.transformeterHelp">1-3: Minor changes | 4-6: Moderate changes | 7-10: Major transformation</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label"><span data-translate="parametersCard.decorationLevel">Decoration Level:</span> <span class="slider-value" id="decorationValue">8</span></label>
                        <div class="slider-container">
                            <input type="range" min="1" max="10" value="8" class="slider" id="decoration" oninput="updateSlider('decoration', 'decorationValue')">
                        </div>
                        <div class="form-help">
                            <span>ðŸŽ¨</span>
                            <span data-translate="parametersCard.decorationHelp">How much decorative detail to include (1: minimal, 10: maximum)</span>
                        </div>
                    </div>
                </div>
            `,
            'from-scratch': `
                ${renderProductSelector()}
                ${renderStylePresets()}
                ${renderRatioButtons()}
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span>ðŸŽ¯</span>
                            <span data-translate="parametersCard.title">Project Parameters</span>
                        </h3>
                        <p class="card-description" data-translate="parametersCard.description">Provide details about your design requirements</p>
                    </div>
                    <div class="optional-fields">
                        <div class="form-group">
                            <label class="form-label" for="destination" data-translate="parametersCard.destination">Destination *</label>
                            <input type="text" id="destination" class="form-input" data-translate-placeholder="parametersCard.destinationPlaceholder" placeholder="e.g., Hermosillo, CDMX" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="theme" data-translate="parametersCard.theme">Theme</label>
                            <input type="text" id="theme" class="form-input" data-translate-placeholder="parametersCard.themePlaceholder" placeholder="e.g., Traditional, Modern">
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="form-group">
                        <label class="form-label"><span data-translate="parametersCard.crazymeterLevel">Crazymeter Level:</span> <span class="slider-value" id="crazymeterValue">5</span></label>
                        <div class="slider-container">
                            <input type="range" min="1" max="10" value="5" class="slider" id="crazymeter" oninput="updateSlider('crazymeter', 'crazymeterValue')">
                        </div>
                        <div class="form-help">
                            <span>ðŸ¤ª</span>
                            <span data-translate="parametersCard.crazymeterHelp">1-3: Traditional designs | 4-6: Creative twists | 7-10: Wild, unconventional ideas</span>
                        </div>
                    </div>
                </div>
            `,
            'previous-element': `
                ${renderProductSelector()}
                ${renderStylePresets()}
                ${renderRatioButtons()}
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span>ðŸŽ¯</span>
                            <span data-translate="parametersCard.title">Project Parameters</span>
                        </h3>
                        <p class="card-description" data-translate="parametersCard.description">Provide details about your design requirements</p>
                    </div>
                    <div class="optional-fields">
                        <div class="form-group">
                            <label class="form-label" for="destination" data-translate="parametersCard.destination">Destination *</label>
                            <input type="text" id="destination" class="form-input" data-translate-placeholder="parametersCard.destinationPlaceholder" placeholder="e.g., Hermosillo, CDMX" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="elementDescription" data-translate="parametersCard.elementDescription">Previous Element Description</label>
                            <input type="text" id="elementDescription" class="form-input" data-translate-placeholder="parametersCard.elementPlaceholder" placeholder="Describe the element to build from">
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="form-group">
                        <label class="form-label"><span data-translate="parametersCard.crazymeterLevel">Crazymeter Level:</span> <span class="slider-value" id="crazymeterValue">5</span></label>
                        <div class="slider-container">
                            <input type="range" min="1" max="10" value="5" class="slider" id="crazymeter" oninput="updateSlider('crazymeter', 'crazymeterValue')">
                        </div>
                        <div class="form-help">
                            <span>ðŸ¤ª</span>
                            <span data-translate="parametersCard.crazymeterHelp">1-3: Traditional designs | 4-6: Creative twists | 7-10: Wild, unconventional ideas</span>
                        </div>
                    </div>
                </div>
            `,
            'modify': `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span>ðŸ”§</span>
                            <span data-translate="modifyCard.title">Modification Instructions</span>
                        </h3>
                        <p class="card-description" data-translate="modifyCard.description">Upload the design you want to modify, then describe the changes in the instructions field</p>
                    </div>
                </div>
            `
        };

        // Load projects
        async function loadProjects() {
            try {
                const response = await fetch('/api/projects');
                const projects = await response.json();

                const selector = document.getElementById('projectSelector');
                selector.innerHTML = '';

                Object.entries(projects).forEach(([key, project]) => {
                    const card = document.createElement('button');
                    card.className = 'project-card';
                    card.style.color = project.color;
                    const translationKey = `projects.${key.replace(/-/g, '')}`;
                    card.innerHTML = `
                        <span class="project-card-icon">${project.icon}</span>
                        <div class="project-card-content">
                            <div class="project-card-title" data-translate="${translationKey}">${project.name}</div>
                        </div>
                    `;
                    card.onclick = () => selectProject(key, project, card);
                    selector.appendChild(card);
                });

                // Translate project cards
                setLanguage(currentLanguage);
            } catch (error) {
                console.error('Error loading projects:', error);
            }
        }

        function selectProject(key, project, element) {
            currentProject = key;

            // Update header with translated project name
            document.getElementById('currentIcon').textContent = project.icon;
            const projectNameKey = `projects.${key.replace(/-/g, '')}`;
            const projectName = translations[currentLanguage].projects[key.replace(/-/g, '')] || project.name;
            document.getElementById('currentProject').textContent = projectName;

            // Update active button
            document.querySelectorAll('.project-card').forEach(card => card.classList.remove('active'));
            element.classList.add('active');

            // Load project-specific fields
            const dynamicFields = document.getElementById('dynamicFields');
            dynamicFields.innerHTML = projectFields[key] || '';

            // Translate the newly added dynamic fields
            setTimeout(() => {
                setLanguage(currentLanguage);
            }, 0);

            // Hide template window for modify project
            const templateWindow = document.getElementById('templateWindow');
            if (key === 'modify') {
                templateWindow.classList.add('hidden');
            } else {
                templateWindow.classList.remove('hidden');
            }

            // Update photo style selector visibility based on both project and style
            setTimeout(() => {
                updatePhotoStyleSelectorVisibility();
            }, 100);
        }

        function updateSlider(sliderId, valueId) {
            const value = document.getElementById(sliderId).value;
            document.getElementById(valueId).textContent = value;
        }

        // Helper function to convert data URL to Blob
        function dataURLtoBlob(dataUrl) {
            const arr = dataUrl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while(n--){
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], {type: mime});
        }

        // Image upload handling
        let imageDataUrls = [];

        function updateImageCount() {
            const count = selectedImages.length + imageDataUrls.length + selectedShapes.length;
            const countDisplay = document.getElementById('imageCountDisplay');
            const countText = document.getElementById('imageCount');
            const persistNote = document.getElementById('imagesPersistNote');

            if (count > 0) {
                countDisplay.style.display = 'inline-flex';
                persistNote.style.display = 'flex';
                countText.textContent = count;
            } else {
                countDisplay.style.display = 'none';
                persistNote.style.display = 'none';
            }
        }

        function clearAllImages() {
            if (confirm(translations[currentLanguage].alerts.clearImages)) {
                selectedImages = [];
                imageDataUrls = [];

                selectedShapes.forEach(shape => {
                    const shapeOption = document.getElementById('shape-option-' + shape.id.split('-')[1]);
                    if (shapeOption) {
                        shapeOption.classList.remove('selected');
                    }
                });
                selectedShapes = [];

                refreshImagePreviews();
            }
        }

        function addImageToPreview(src, index, isPasted = false) {
            const preview = document.getElementById('imagePreview');

            const container = document.createElement('div');
            container.className = 'preview-img-container';
            container.dataset.index = index;
            container.dataset.isPasted = isPasted;

            const img = document.createElement('img');
            img.src = src;
            img.className = 'preview-img';

            const removeBtn = document.createElement('div');
            removeBtn.className = 'remove-img-btn';
            removeBtn.innerHTML = 'Ã—';
            removeBtn.title = 'Remove image';
            removeBtn.onclick = (e) => {
                e.stopPropagation();
                removeImage(index, isPasted);
            };

            container.appendChild(img);
            container.appendChild(removeBtn);
            preview.appendChild(container);
        }

        function removeImage(index, isPasted) {
            if (isPasted) {
                imageDataUrls.splice(index, 1);
            } else {
                selectedImages.splice(index, 1);
            }
            refreshImagePreviews();
        }

        function refreshImagePreviews() {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';

            selectedImages.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    addImageToPreview(e.target.result, index, false);
                };
                reader.readAsDataURL(file);
            });

            imageDataUrls.forEach((dataUrl, index) => {
                addImageToPreview(dataUrl, index, true);
            });

            selectedShapes.forEach((shape) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    addShapeToPreview(e.target.result, shape.id, shape.name);
                };
                reader.readAsDataURL(shape.file);
            });

            updateImageCount();
        }

        // Click to upload
        document.getElementById('imageUpload').onclick = () => {
            document.getElementById('imageInput').click();
        };

        // File input change
        document.getElementById('imageInput').addEventListener('change', (e) => {
            const newFiles = Array.from(e.target.files);
            selectedImages = [...selectedImages, ...newFiles];
            refreshImagePreviews();
            e.target.value = '';
        });

        // Paste image handling
        document.addEventListener('paste', (e) => {
            const items = e.clipboardData?.items;
            if (!items) return;

            let imageFound = false;

            for (let i = 0; i < items.length; i++) {
                if (items[i].type.indexOf('image') !== -1) {
                    imageFound = true;
                    const blob = items[i].getAsFile();
                    const reader = new FileReader();

                    reader.onload = (event) => {
                        imageDataUrls.push(event.target.result);
                        refreshImagePreviews();
                    };

                    reader.readAsDataURL(blob);
                }
            }

            if (imageFound) {
                e.preventDefault();
                const imageUpload = document.getElementById('imageUpload');
                const originalBorder = imageUpload.style.borderColor;
                imageUpload.style.borderColor = 'var(--axkan-green)';
                imageUpload.style.borderWidth = '3px';
                setTimeout(() => {
                    imageUpload.style.borderColor = originalBorder;
                    imageUpload.style.borderWidth = '';
                }, 500);
            }
        });

        // Generate prompts
        async function generatePrompts() {
            if (!currentProject) {
                alert(translations[currentLanguage].alerts.selectProject);
                return;
            }

            const instructions = document.getElementById('instructions').value;
            if (!instructions.trim()) {
                alert(translations[currentLanguage].alerts.provideInstructions);
                return;
            }

            const variationCount = parseInt(document.getElementById('variationCount').value) || 1;
            if (variationCount < 1 || variationCount > 10) {
                alert(translations[currentLanguage].alerts.variationRange);
                return;
            }

            const formData = new FormData();
            formData.append('projectType', currentProject);
            formData.append('instructions', instructions);
            formData.append('variationCount', variationCount);
            formData.append('productType', selectedProduct);

            if (selectedStyle) {
                formData.append('style', selectedStyle);
            }
            formData.append('ratio', selectedRatio);

            if (selectedProduct === 'bottle-opener') {
                formData.append('includeShapeConstraints', 'true');
            }

            if (selectedPhotoStyle) {
                formData.append('photoStyle', selectedPhotoStyle);
            }

            // Add turbo mode parameter
            if (turboMode) {
                formData.append('turboMode', 'true');
            }

            const fields = ['destination', 'theme', 'level', 'format', 'elementDescription', 'modificationType'];
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (element) {
                    formData.append(field, element.value);
                }
            });

            // Handle decoration level with correct parameter name expected by server
            const decorationElement = document.getElementById('decoration');
            if (decorationElement) {
                formData.append('decorationLevel', decorationElement.value);
            }

            // Handle crazymeter level for from-scratch and previous-element projects
            const crazymeterElement = document.getElementById('crazymeter');
            if (crazymeterElement) {
                formData.append('crazymeter', crazymeterElement.value);
            }

            selectedImages.forEach(file => {
                formData.append('images', file);
            });

            imageDataUrls.forEach((dataUrl, index) => {
                const blob = dataURLtoBlob(dataUrl);
                formData.append('images', blob, `pasted-image-${index}.png`);
            });

            selectedShapes.forEach(shape => {
                formData.append('images', shape.file);
            });

            const outputSection = document.getElementById('outputSection');
            const variationsContainer = document.getElementById('variationsContainer');
            outputSection.classList.add('visible');
            const varText = variationCount > 1 ? translations[currentLanguage].loading.variations : translations[currentLanguage].loading.variation;
            variationsContainer.innerHTML = `
                <div class="loading" id="streamingStatus">
                    <div class="spinner"></div>
                    <div class="loading-text">${translations[currentLanguage].loading.starting} ${variationCount} ${varText}...</div>
                    <div class="form-help" style="justify-content: center;">${translations[currentLanguage].loading.willAppear}</div>
                </div>
            `;

            // Collect data for history
            const historyData = {
                projectType: currentProject,
                instructions: instructions,
                variationCount: variationCount,
                productType: selectedProduct,
                style: selectedStyle,
                ratio: selectedRatio,
                turboMode: turboMode,
                destination: document.getElementById('destination')?.value || '',
                theme: document.getElementById('theme')?.value || '',
                level: document.getElementById('level')?.value || '',
                decorationLevel: document.getElementById('decoration')?.value || '',
                crazymeter: document.getElementById('crazymeter')?.value || '',
                prompts: []
            };

            try {
                const response = await fetch('/api/generate-prompt-stream', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';
                let receivedCount = 0;
                let totalCount = variationCount;

                while (true) {
                    const { done, value } = await reader.read();

                    if (done) {
                        break;
                    }

                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');

                    buffer = lines.pop();

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = JSON.parse(line.slice(6));

                            if (data.type === 'start') {
                                totalCount = data.total;
                                const statusDiv = document.getElementById('streamingStatus');
                                if (statusDiv) {
                                    const varText = totalCount > 1 ? translations[currentLanguage].loading.variations : translations[currentLanguage].loading.variation;
                                    statusDiv.querySelector('.loading-text').textContent =
                                        `${translations[currentLanguage].loading.generating} ${totalCount} ${varText}... (0/${totalCount} ${translations[currentLanguage].loading.complete})`;
                                }
                            } else if (data.type === 'variation') {
                                receivedCount++;

                                // Collect prompt for history
                                if (data.variation && data.variation.prompt) {
                                    historyData.prompts.push(data.variation.prompt);
                                }

                                const statusDiv = document.getElementById('streamingStatus');
                                if (statusDiv) {
                                    statusDiv.querySelector('.loading-text').textContent =
                                        `${translations[currentLanguage].loading.generating} ${translations[currentLanguage].loading.variations}... (${receivedCount}/${totalCount} ${translations[currentLanguage].loading.complete})`;
                                }

                                displayVariation(data.variation, data.index);

                                setTimeout(() => {
                                    const newCard = document.getElementById(`variation-card-${data.index}`);
                                    if (newCard) {
                                        newCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                                    }
                                }, 100);
                            } else if (data.type === 'complete') {
                                const statusDiv = document.getElementById('streamingStatus');
                                if (statusDiv) {
                                    statusDiv.remove();
                                }
                                // Save to history when generation completes
                                if (historyData.prompts.length > 0) {
                                    saveToHistory(historyData);
                                }
                            } else if (data.type === 'error') {
                                variationsContainer.innerHTML = `<div class="loading"><div class="loading-text" style="color: var(--axkan-red);">Error: ${data.error}</div></div>`;
                            }
                        }
                    }
                }
            } catch (error) {
                variationsContainer.innerHTML = `<div class="loading"><div class="loading-text" style="color: var(--axkan-red);">Error: ${error.message}</div></div>`;
            }
        }

        function displayVariation(variation, index) {
            const container = document.getElementById('variationsContainer');

            const card = document.createElement('div');
            card.className = 'variation-card';
            card.id = `variation-card-${index}`;
            card.style.animation = 'fadeIn 0.5s ease-in';
            card.innerHTML = `
                <div class="variation-header">
                    <div class="variation-title">${variation.title || `${translations[currentLanguage].variationTitle} ${index + 1}`}</div>
                    <button class="copy-btn" onclick="copyToClipboard(${index})">${translations[currentLanguage].copyToClipboard}</button>
                </div>
                <div class="prompt-output" id="prompt-${index}">${variation.prompt}</div>
            `;
            container.appendChild(card);
        }

        async function copyToClipboard(index) {
            const text = document.getElementById(`prompt-${index}`).textContent;
            await navigator.clipboard.writeText(text);

            const btns = document.querySelectorAll('.copy-btn');
            const btn = btns[index];
            const originalText = btn.textContent;
            btn.textContent = translations[currentLanguage].copied;
            btn.classList.add('copied');

            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('copied');
            }, 2000);
        }

        // Settings
        function openSettings() {
            document.getElementById('settingsModal').classList.add('visible');
            const apiKey = localStorage.getItem('claudeApiKey');
            if (apiKey) {
                document.getElementById('apiKey').value = apiKey;
            }
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('visible');
        }

        function saveSettings() {
            const apiKey = document.getElementById('apiKey').value;
            if (apiKey) {
                localStorage.setItem('claudeApiKey', apiKey);
                alert(translations[currentLanguage].alerts.settingsSaved);
            } else {
                localStorage.removeItem('claudeApiKey');
                alert(translations[currentLanguage].alerts.settingsSavedTemplate);
            }
            closeSettings();
        }

        // History Management
        const HISTORY_KEY = 'designPromptHistory';
        const MAX_HISTORY_ITEMS = 50;

        function getHistory() {
            try {
                const history = localStorage.getItem(HISTORY_KEY);
                return history ? JSON.parse(history) : [];
            } catch (e) {
                console.error('Error loading history:', e);
                return [];
            }
        }

        function saveToHistory(item) {
            try {
                let history = getHistory();
                // Add new item at the beginning
                history.unshift({
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    ...item
                });
                // Limit history size
                if (history.length > MAX_HISTORY_ITEMS) {
                    history = history.slice(0, MAX_HISTORY_ITEMS);
                }
                localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
                updateHistoryBadge();
                renderHistory();
            } catch (e) {
                console.error('Error saving to history:', e);
            }
        }

        function deleteFromHistory(id) {
            if (!confirm(translations[currentLanguage].history.confirmDelete)) return;
            try {
                let history = getHistory();
                history = history.filter(item => item.id !== id);
                localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
                updateHistoryBadge();
                renderHistory();
            } catch (e) {
                console.error('Error deleting from history:', e);
            }
        }

        function clearHistory() {
            if (!confirm(translations[currentLanguage].history.confirmClear)) return;
            try {
                localStorage.removeItem(HISTORY_KEY);
                updateHistoryBadge();
                renderHistory();
            } catch (e) {
                console.error('Error clearing history:', e);
            }
        }

        function updateHistoryBadge() {
            const history = getHistory();
            const badge = document.getElementById('historyBadge');
            if (history.length > 0) {
                badge.textContent = history.length > 99 ? '99+' : history.length;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function toggleHistory() {
            const sidebar = document.getElementById('historySidebar');
            const overlay = document.getElementById('historyOverlay');
            const isVisible = sidebar.classList.contains('visible');

            if (isVisible) {
                sidebar.classList.remove('visible');
                overlay.classList.remove('visible');
            } else {
                sidebar.classList.add('visible');
                overlay.classList.add('visible');
                renderHistory();
            }
        }

        function renderHistory() {
            const history = getHistory();
            const content = document.getElementById('historyContent');
            const emptyState = document.getElementById('historyEmpty');

            if (history.length === 0) {
                content.innerHTML = '';
                content.appendChild(emptyState);
                emptyState.style.display = 'block';
                return;
            }

            const projectNames = {
                'variations': { icon: 'ðŸ”„', name: 'Variations' },
                'from-scratch': { icon: 'âœ¨', name: 'From Scratch' },
                'previous-element': { icon: 'ðŸ§©', name: 'Previous Element' },
                'modify': { icon: 'ðŸ”§', name: 'Modify' }
            };

            content.innerHTML = history.map(item => {
                const project = projectNames[item.projectType] || { icon: 'ðŸ“„', name: item.projectType };
                const date = new Date(item.timestamp);
                const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const preview = item.prompts && item.prompts[0] ? item.prompts[0].substring(0, 150) + '...' : item.instructions?.substring(0, 150) + '...';

                const metaTags = [];
                if (item.destination) metaTags.push(`ðŸ“ ${item.destination}`);
                if (item.style) metaTags.push(`ðŸŽ¨ ${item.style}`);
                if (item.ratio) metaTags.push(`ðŸ“ ${item.ratio}`);
                if (item.productType) metaTags.push(`ðŸ“¦ ${item.productType}`);
                if (item.variationCount) metaTags.push(`#${item.variationCount} variations`);

                return `
                    <div class="history-item" data-id="${item.id}">
                        <div class="history-item-header">
                            <div class="history-item-project">
                                <span>${project.icon}</span>
                                <span>${project.name}</span>
                            </div>
                            <div class="history-item-date">${formattedDate}</div>
                        </div>
                        <div class="history-item-preview">${preview}</div>
                        ${metaTags.length > 0 ? `
                            <div class="history-item-meta">
                                ${metaTags.map(tag => `<span class="history-meta-tag">${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                        <div class="history-item-actions">
                            <button class="history-action-btn copy" onclick="copyFromHistory(${item.id})">
                                ðŸ“‹ ${translations[currentLanguage].history.copy}
                            </button>
                            <button class="history-action-btn reuse" onclick="reuseFromHistory(${item.id})">
                                ðŸ”„ ${translations[currentLanguage].history.reuse}
                            </button>
                            <button class="history-action-btn delete" onclick="deleteFromHistory(${item.id})">
                                ðŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function copyFromHistory(id) {
            const history = getHistory();
            const item = history.find(h => h.id === id);
            if (!item || !item.prompts || !item.prompts[0]) return;

            try {
                await navigator.clipboard.writeText(item.prompts.join('\n\n---\n\n'));

                // Show feedback
                const btn = document.querySelector(`[data-id="${id}"] .history-action-btn.copy`);
                if (btn) {
                    const originalText = btn.innerHTML;
                    btn.innerHTML = `âœ“ ${translations[currentLanguage].history.copiedFromHistory}`;
                    btn.classList.add('copied');
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.classList.remove('copied');
                    }, 2000);
                }
            } catch (e) {
                console.error('Error copying from history:', e);
            }
        }

        function reuseFromHistory(id) {
            const history = getHistory();
            const item = history.find(h => h.id === id);
            if (!item) return;

            // Close history sidebar
            toggleHistory();

            // Select the project type
            const projectCards = document.querySelectorAll('.project-card');
            projectCards.forEach(card => {
                const projectKey = Object.keys({
                    'variations': 'Generate Variations',
                    'from-scratch': 'Create New Design',
                    'previous-element': 'Previous Element',
                    'modify': 'Modify Design'
                }).find(key => card.querySelector('.project-card-title')?.textContent.toLowerCase().includes(key.replace('-', ' ')));

                if (card.querySelector('.project-card-title')?.closest('.project-card')) {
                    // Click the matching project card
                    const projectButtons = document.querySelectorAll('.project-card');
                    projectButtons.forEach((btn, index) => {
                        const keys = ['variations', 'from-scratch', 'previous-element', 'modify'];
                        if (keys[index] === item.projectType) {
                            btn.click();
                        }
                    });
                }
            });

            // Wait for dynamic fields to load, then populate
            setTimeout(() => {
                // Set instructions
                const instructionsField = document.getElementById('instructions');
                if (instructionsField && item.instructions) {
                    instructionsField.value = item.instructions;
                }

                // Set destination
                const destinationField = document.getElementById('destination');
                if (destinationField && item.destination) {
                    destinationField.value = item.destination;
                }

                // Set theme
                const themeField = document.getElementById('theme');
                if (themeField && item.theme) {
                    themeField.value = item.theme;
                }

                // Set variation count
                const variationCountField = document.getElementById('variationCount');
                if (variationCountField && item.variationCount) {
                    variationCountField.value = item.variationCount;
                }

                // Set style if available
                if (item.style) {
                    const styleButtons = document.querySelectorAll('.style-preset-btn');
                    styleButtons.forEach(btn => {
                        if (btn.dataset.style === item.style) {
                            btn.click();
                        }
                    });
                }

                // Set ratio if available
                if (item.ratio) {
                    const ratioButtons = document.querySelectorAll('.ratio-btn');
                    ratioButtons.forEach(btn => {
                        if (btn.dataset.ratio === item.ratio) {
                            btn.click();
                        }
                    });
                }

                // Set product type if available
                if (item.productType) {
                    const productButtons = document.querySelectorAll('.product-btn');
                    productButtons.forEach(btn => {
                        if (btn.dataset.product === item.productType) {
                            btn.click();
                        }
                    });
                }

                // Set sliders
                if (item.level) {
                    const levelSlider = document.getElementById('level');
                    if (levelSlider) {
                        levelSlider.value = item.level;
                        updateSlider('level', 'levelValue');
                    }
                }

                if (item.decorationLevel) {
                    const decorationSlider = document.getElementById('decoration');
                    if (decorationSlider) {
                        decorationSlider.value = item.decorationLevel;
                        updateSlider('decoration', 'decorationValue');
                    }
                }

                if (item.crazymeter) {
                    const crazymeterSlider = document.getElementById('crazymeter');
                    if (crazymeterSlider) {
                        crazymeterSlider.value = item.crazymeter;
                        updateSlider('crazymeter', 'crazymeterValue');
                    }
                }

                // Set turbo mode
                if (item.turboMode) {
                    const turboToggle = document.getElementById('turboToggle');
                    if (turboToggle && !turboToggle.checked) {
                        turboToggle.click();
                    }
                }

                // Show notification
                alert(translations[currentLanguage].history.settingsLoaded);
            }, 300);
        }

        // Initialize
        document.getElementById('generateBtn').onclick = generatePrompts;
        loadProjects();

        window.addEventListener('DOMContentLoaded', () => {
            const savedLang = localStorage.getItem('language');
            if (savedLang) {
                setLanguage(savedLang);
            }
            // Initialize history badge
            updateHistoryBadge();
        });
    </script>
</body>
</html>
